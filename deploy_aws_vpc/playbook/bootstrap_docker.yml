---
# Install docker-ce

- hosts: "{{ variable_host | default('all') }}"
  remote_user: "{{ remote_user_account }}"
  gather_facts: false
  vars_files:
    - "./../vars/common.yml"
    - "./../vault/environment/{{ vpc_env }}/vault.yml"
    - "./../vars/environment/{{ vpc_env }}/env.yml"

  tasks:

    - name: apt update
      raw: sudo apt-get -y update

    - name: install pre-requisites
      raw: sudo apt-get -y install  apt-transport-https ca-certificates curl software-properties-common

    - name: add docker GPG key
      raw: curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

    - name: setup stable repository
      raw: sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"

    - name: refresh apt for latest updates
      raw: sudo apt-get -y update

    - name: install docker CE
      raw: sudo apt-get -y install docker-ce

    - name: hello world
      become_user: ubuntu
      raw: sudo docker run hello-world
      register: docker_installed_result

    - debug:
        msg: "{{ docker_installed_result.stdout }}"
