---
# roles/git_deploy/tasks/main.yml
# Created: 2019-09-05
# cdex-deploy : 
# Purpose:
# deploy git.{{ role_type }} to target
#    
#    

- name: "remove target directory: /home/{{ remote_user_account }}/cdex.{{ vpc_env }}"
  file:
    path: "/home/{{ remote_user_account }}/cdex.{{ vpc_env }}"
    state: absent

- name: "git clone cdex.{{ vpc_env }}"
  git:
    repo: "https://github.com/transparenthealth/cdex.{{ vpc_env }}.git"
    dest: "/home/{{ remote_user_account }}/cdex.{{ vpc_env }}"
    clone: yes
    force: yes
    version: "{{ git_branch | default('HEAD') }}"

- name: "remove target directory: /home/{{ remote_user_account }}/cdex.{{ vpc_env }}/{{ role_type }}"
  file:
    path: "/home/{{ remote_user_account }}/cdex.{{ vpc_env }}/{{ role_type }}"
    state: absent

- name: "git clone {{ role_type }} into cdex.{{ vpc_env }}"
  git:
    repo: "https://github.com/transparenthealth/{{ role?-type }}.git"
    dest: "/home/{{ remote_user_account }}/cdex.{{ vpc_env }}/{{ role_type }}"
    clone: yes
    force: yes


